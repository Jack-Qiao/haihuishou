# 嗨回收抢单工具 - 需求文档

## 1. 项目概述

### 1.1 产品名称
嗨回收抢单工具（haihuishou）

### 1.2 产品目标
基于嗨回收平台接口，为报价师提供 Web 端抢单与报价能力：登录后可按条件查询订单列表，对待报价订单执行抢单并提交报价，对报价中/已报价订单进行报价或修改报价，提升在电脑端的操作效率。

### 1.3 目标用户
- 使用嗨回收平台的报价师/回收商，需在电脑端快速查看订单、抢单、报价。

### 1.4 使用场景
- 在浏览器中完成登录、筛选条件设置、订单列表查询、抢单、提交/修改报价等全流程操作。
- 支持打包为单机可执行程序（exe / 可执行文件），在其他电脑免安装 Python 直接运行。

---

## 2. 功能需求

### 2.1 登录与登出

| 需求项 | 描述 |
|--------|------|
| 登录 | 用户输入手机号、密码，调用平台登录接口；成功后服务端保存 token、userId（Session），前端跳转至主界面。 |
| 登出 | 用户点击「退出」后清除 Session，返回登录页并清空账号密码输入框。 |
| 登录态校验 | 页面加载时请求 `/api/status`，已登录则进入主界面并拉取用户信息与基础数据，未登录则显示登录页。 |

### 2.2 用户信息展示

| 需求项 | 描述 |
|--------|------|
| 获取用户信息 | 登录成功后调用「查询用户信息」接口（queryuserinfo），入参为 userId，出参含 realName、mobile、balance 等。 |
| 展示位置 | 主界面右上方展示「已登录」+ 用户真实姓名（realName）；若接口失败则回退显示 userId。 |

### 2.3 基础数据（电子产品信息选择）

| 需求项 | 描述 |
|--------|------|
| 数据内容 | 厂商列表（多选）、电子产品类型（单选，如手机/平板/笔记本）、按类型加载的品牌列表（多选，含「全部」）。 |
| 展示方式 | 整块区域可折叠，默认折叠；展开后展示厂商、类型、品牌选择。 |
| 数据来源 | 厂商：getmanufacturerdata；类型：getsyscategory；品牌：getsysbrand（传入 catId）。 |
| 默认选择 | 进入主界面后默认选中第一个类型（如手机），并拉取该类型下品牌列表。 |

### 2.4 抢单条件与订单列表

| 需求项 | 描述 |
|--------|------|
| 订单状态 | 单选：待报价、报价中、已报价；切换状态即重新查询列表。 |
| 价格筛选 | 最低价、最高价为选填；有值时才参与查询。 |
| 查询条件 | 综合「基础数据」中的厂商、类型、品牌 + 订单状态 + 最低价/最高价 + 分页（页码、每页条数）请求订单列表。 |
| 列表展示 | 表头与列随订单状态变化：已报价多一列「报价金额」；待报价操作列为「抢单」，报价中/已报价为「报价」/「修改报价」。 |
| 列表内容 | 至少包含：产品名称、预估金额、规格、厂商、倒计时、操作；预估金额为 0 或空时显示「-」；倒计时每秒更新。 |

### 2.5 重置查询条件

| 需求项 | 描述 |
|--------|------|
| 重置按钮 | 在「查询订单」按钮左侧提供「重置」按钮，与「查询订单」紧挨。 |
| 重置范围 | 订单状态恢复为「待报价」；最低价、最高价清空；页码恢复为 1，每页条数恢复为 20；厂商勾选全部取消；电子产品类型选第一个（如手机）并重新拉取品牌；品牌恢复为默认未勾选。 |
| 重置后行为 | 重置后自动按默认条件执行一次查询，刷新列表。 |

### 2.6 抢单

| 需求项 | 描述 |
|--------|------|
| 触发 | 在「待报价」列表行点击「抢单」。 |
| 流程 | 先调用抢单接口（如 hsdgraborder），成功后再打开报价弹窗；失败则提示接口返回信息（如已被他人抢单）。 |

### 2.7 报价弹窗（提交报价 / 修改报价）

| 需求项 | 描述 |
|--------|------|
| 弹窗标题 | 「提交报价」。 |
| 展示项 | recordId、orderId（只读，不可编辑）；预估金额（醒目样式：加粗、较大字号、强调色）；报价金额（必填，≥1）；备注（选填）。 |
| 预估金额 | 仅展示用，样式明显区别于普通文字。 |
| 提交校验 | 报价金额必填且 ≥ 1；若存在预估金额且报价金额 ≥ 预估金额 × 1.5，需二次确认「报价金额已超过预估金额的1.5倍，确定要提交报价吗？」。 |
| 提交逻辑 | 待报价/报价中：先抢单（若为待报价）再提交报价（hsdquotation）；已报价：调用修改报价接口（hsdupdatequotation）。 |
| 提交后 | 关闭弹窗并重新查询当前列表。 |

### 2.8 分页

| 需求项 | 描述 |
|--------|------|
| 展示 | 左侧显示总条数；右侧提供上一页、下一页、页码（如 1 2 3 …）、每页条数下拉（10/20/50/100）、跳至第 N 页输入框与「跳转」按钮。 |
| 行为 | 切换页码、每页条数、跳转后均重新请求订单列表并更新分页状态。 |

### 2.9 其他交互

| 需求项 | 描述 |
|--------|------|
| 提示信息 | 列表区域上方可展示操作结果或错误信息（如抢单失败、报价成功）；弹窗内可展示提交错误信息。 |
| 弹窗关闭 | 取消或提交成功后关闭报价弹窗，并刷新订单列表。 |

---

## 3. 接口需求（后端对接嗨回收平台）

### 3.1 平台侧接口（参考）

| 用途 | 说明 |
|------|------|
| 登录 | POST 登录接口，入参 loginName、loginPwd（MD5），出参 token、userId。 |
| 用户信息 | POST queryuserinfo，入参 userId，出参 realName、mobile、balance 等。 |
| 厂商/分类/品牌 | getmanufacturerdata、getsyscategory、getsysbrand（catId）。 |
| 订单列表 | gethsdorderlist，入参含 categoryBrands、subOrderSourceNames、orderState、pageIndex、pageSize、minPrice/maxPrice（可选）、userId；请求头带 token。 |
| 抢单 | hsdgraborder，入参 recordId、orderId、userId，请求头带 token。 |
| 提交报价 | hsdquotation，入参 recordId、orderId、actualPrice、remark、userId 等，请求头带 token。 |
| 修改报价 | hsdupdatequotation，入参 recordId、orderId、actualPrice、remark、userId 等，请求头带 token。 |

### 3.2 本系统 Web API（供前端调用）

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 返回抢单工具单页 HTML。 |
| POST | /api/login | 登录，body：loginName、loginPwd。 |
| POST | /api/logout | 登出，清除 Session。 |
| GET | /api/status | 登录态，返回 loggedIn、userId、token。 |
| GET | /api/user-info | 当前用户信息（姓名等），需已登录。 |
| GET | /api/categories | 厂商与电子产品类型。 |
| GET | /api/brands | 品牌，query：catId。 |
| POST | /api/order-list | 订单列表，body：categoryBrands、orderState、minPrice、maxPrice、subOrderSourceNames、pageIndex、pageSize 等；header：token；body 需带 userId。 |
| POST | /api/grab-order | 抢单，body：recordId、orderId、userId；header：token。 |
| POST | /api/quote | 提交报价，body：recordId、orderId、actualPrice、remark、quoteResult、userId；header：token。 |
| POST | /api/update-quote | 修改报价，body：recordId、orderId、actualPrice、remark、userId；header：token。 |

---

## 4. 非功能需求

### 4.1 运行环境
- Python 3.8+；依赖见 `requirements.txt`（如 Flask、requests）。
- 默认本机访问地址：http://127.0.0.1:5050（host/port 可通过环境变量配置）。

### 4.2 部署与分发
- 支持使用 PyInstaller 打包为单文件可执行程序（Windows 为 exe，macOS/Linux 为无扩展名可执行文件）。
- 打包后运行即启动本地 Web 服务，并可自动打开浏览器访问上述地址；关闭控制台窗口即退出程序。
- Windows 版本需在 Windows 环境下打包，或通过 CI（如 GitHub Actions）在 Windows runner 上构建 exe。

### 4.3 安全与合规
- 仅用于学习或经授权的调试，须遵守平台规则与相关法律法规。
- 账号密码不提交至仓库，建议通过环境变量或本地配置传入。
- 与平台通信时可根据需要关闭 SSL 证书校验（环境变量控制），生产或敏感环境应评估后使用。

### 4.4 兼容性
- 前端为单页 HTML，依赖现代浏览器；请求头与请求体为 JSON，需支持 Fetch/JSON。

---

## 5. 约束与说明

- 订单列表、抢单、报价等接口以嗨回收平台实际接口为准，本需求文档中的接口名称与字段为当前实现参考。
- 列表字段（如 recordId、orderId、预估金额、报价金额）以平台返回为准，若列表未直接返回则需从详情等接口获取。
- 需求文档随产品迭代可增删改，以实际代码与 README 为最终实现依据。

---

## 6. 文档与版本

- 本文档为「嗨回收抢单工具」产品需求说明，与 `README.md`、代码实现一起维护。
- 若后续有重大功能变更，建议同步更新本文档。
